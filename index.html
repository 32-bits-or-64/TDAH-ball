<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDAH Ball - Fixed</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #111111; font-family: sans-serif; }
        #bgCanvas { position: fixed; top: 0; left: 0; z-index: 0; }
        #game-container { position: fixed; top: 0; left: 0; z-index: 1; width: 100vw; height: 100vh; pointer-events: none; }
        #game-container canvas { pointer-events: auto; }
        #ui-container { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; }
        .panel { pointer-events: auto; background: rgba(15, 15, 15, 0.95); padding: 15px; border-radius: 10px; color: #fff; width: 180px; border: 1px solid #444; }
        #glow { position: absolute; width: 250px; height: 250px; background: radial-gradient(circle, rgba(241,196,15,0.4) 0%, transparent 70%); pointer-events: none; z-index: 5; transform: translate(-50%, -50%); mix-blend-mode: screen; }
        button { background: #f1c40f; border: none; padding: 8px; width: 100%; font-weight: bold; cursor: pointer; border-radius: 4px; }
        input, select { width: 100%; margin: 5px 0 10px 0; }
    </style>
</head>
<body>

    <canvas id="bgCanvas"></canvas>
    <div id="game-container"></div>
    <div id="glow"></div>
    
    <div id="ui-container">
        <div class="panel">
            <h3 style="margin:0; color:#f1c40f; font-size:14px;">TDAH PHYSICS</h3>
            <label style="font-size:10px;">IDIOMA</label>
            <select id="langSelect"></select>
            <label style="font-size:10px;">GRAVEDAD</label>
            <input type="range" id="gravRange" min="-1" max="5" step="0.1" value="1">
            <label style="font-size:10px;">REBOTE</label>
            <input type="range" id="bounceRange" min="0" max="1.5" step="0.05" value="0.9">
            <div style="color:#f1c40f; font-family:monospace; margin-bottom:10px;">VEL: <span id="speedVal">0</span></div>
            <button id="resetBtn">RESET</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>

    <script>
    (function() {
        // Función para iniciar todo cuando la librería esté lista
        const init = () => {
            if (typeof Matter === 'undefined') {
                console.log("Esperando a Matter.js...");
                setTimeout(init, 100);
                return;
            }

            const { Engine, Render, Runner, Bodies, Composite, MouseConstraint, Mouse, Events, Body } = Matter;

            // 1. Fondo
            const bg = document.getElementById('bgCanvas');
            const ctx = bg.getContext('2d');
            const draw = () => {
                bg.width = window.innerWidth; bg.height = window.innerHeight;
                for(let y=0; y<bg.height; y+=60) for(let x=0; x<bg.width; x+=60) {
                    ctx.fillStyle = (Math.floor(x/60)%2 === Math.floor(y/60)%2) ? '#111111' : '#141414';
                    ctx.fillRect(x,y,60,60);
                }
            };
            draw(); window.onresize = draw;

            // 2. Motor
            const engine = Engine.create();
            const render = Render.create({
                element: document.getElementById('game-container'),
                engine: engine,
                options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' }
            });

            // 3. Bola (Textura generada)
            const ball = Bodies.circle(window.innerWidth/2, 150, 50, {
                restitution: 0.9, friction: 0.005,
                render: { sprite: { texture: (() => {
                    const c = document.createElement('canvas'); c.width=c.height=100;
                    const x = c.getContext('2d'); x.beginPath(); x.arc(50,50,50,0,7); x.clip();
                    x.fillStyle="#f1c40f"; x.fillRect(0,0,50,50); x.fillRect(50,50,50,50);
                    x.fillStyle="#000"; x.fillRect(50,0,50,50); x.fillRect(0,50,50,50);
                    return c.toDataURL();
                })() } }
            });

            const wallOpts = { isStatic: true, render: { visible: false } };
            Composite.add(engine.world, [
                ball,
                Bodies.rectangle(window.innerWidth/2, window.innerHeight+50, window.innerWidth, 100, wallOpts),
                Bodies.rectangle(window.innerWidth/2, -50, window.innerWidth, 100, wallOpts),
                Bodies.rectangle(-50, window.innerHeight/2, 100, window.innerHeight, wallOpts),
                Bodies.rectangle(window.innerWidth+50, window.innerHeight/2, 100, window.innerHeight, wallOpts)
            ]);

            const mouse = Mouse.create(render.canvas);
            const mConstraint = MouseConstraint.create(engine, { mouse: mouse, constraint: { stiffness: 0.2, render: { visible: false } } });
            Composite.add(engine.world, mConstraint);

            // 4. Glow & Velocidad
            const glow = document.getElementById('glow');
            Events.on(engine, 'afterUpdate', () => {
                document.getElementById('speedVal').innerText = ball.speed.toFixed(1);
                if(glow) {
                    glow.style.left = ball.position.x + 'px';
                    glow.style.top = ball.position.y + 'px';
                    glow.style.transform = `translate(-50%, -50%) scale(${1+ball.speed/40})`;
                }
            });

            // 5. Idiomas
            const langs = {
                es: ["Física", "Gravedad", "Rebote", "Velocidad", "Reset", "Español"],
                en: ["Physics", "Gravity", "Bounce", "Velocity", "Reset", "English"],
                ja: ["物理学", "重力", "反発", "速度", "リセット", "日本語"]
            };
            const sel = document.getElementById('langSelect');
            Object.keys(langs).forEach(k => { const o = document.createElement('option'); o.value=k; o.innerText=langs[k][5]; sel.appendChild(o); });

            // Controles
            document.getElementById('gravRange').oninput = (e) => engine.gravity.y = parseFloat(e.target.value);
            document.getElementById('bounceRange').oninput = (e) => ball.restitution = parseFloat(e.target.value);
            document.getElementById('resetBtn').onclick = () => Body.setPosition(ball, {x: window.innerWidth/2, y: 100});

            Render.run(render);
            Runner.run(Runner.create(), engine);
        };

        init();
    })();
    </script>
</body>
</html>
