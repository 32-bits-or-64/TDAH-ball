<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDAH Ball - 86 Languages Fix</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #111111; font-family: sans-serif; }
        #bgCanvas { position: fixed; top: 0; left: 0; z-index: 1; }
        #game-container { position: fixed; top: 0; left: 0; z-index: 2; width: 100vw; height: 100vh; }
        #glow { position: absolute; width: 300px; height: 300px; background: radial-gradient(circle, rgba(241,196,15,0.3) 0%, transparent 70%); pointer-events: none; z-index: 3; transform: translate(-50%, -50%); mix-blend-mode: screen; }
        #ui-container { position: absolute; top: 20px; left: 20px; z-index: 100; pointer-events: none; }
        .panel { pointer-events: auto; background: rgba(15, 15, 15, 0.9); backdrop-filter: blur(10px); padding: 20px; border-radius: 12px; color: #fff; width: 220px; border: 1px solid #333; }
        h3 { color: #f1c40f; margin: 0 0 10px; font-size: 14px; text-transform: uppercase; }
        label { font-size: 10px; color: #aaa; display: block; margin-top: 10px; }
        select, input, button { width: 100%; margin-top: 5px; cursor: pointer; }
        select { background: #222; color: #fff; border: 1px solid #444; padding: 5px; }
        button { background: #f1c40f; border: none; padding: 10px; font-weight: bold; border-radius: 5px; margin-top: 15px; }
        .stats { color: #f1c40f; font-family: monospace; margin-top: 10px; }
    </style>
</head>
<body>

    <canvas id="bgCanvas"></canvas>
    <div id="game-container"></div>
    <div id="glow"></div>
    
    <div id="ui-container">
        <div class="panel">
            <h3 id="ui-title">Cargando...</h3>
            <label id="lbl-lang">Language / Idioma</label>
            <select id="langSelect"></select>
            
            <label id="lbl-grav">Gravity</label>
            <input type="range" id="gravRange" min="-1" max="5" step="0.1" value="1">
            
            <label id="lbl-bounce">Bounce</label>
            <input type="range" id="bounceRange" min="0" max="1.5" step="0.05" value="0.8">
            
            <div class="stats"><span id="lbl-speed">Vel</span>: <span id="speedVal">0</span></div>
            <button id="resetBtn">Reset</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>

    <script>
        window.onload = () => {
            const { Engine, Render, Runner, Bodies, Composite, MouseConstraint, Mouse, Events, Body } = Matter;

            // 1. DICCIONARIO MAESTRO (Los 86 idiomas con nombres nativos)
            const i18n = {
                es: ["Física TDAH", "Gravedad", "Rebote", "Velocidad", "Reiniciar", "Español"],
                en: ["ADHD Physics", "Gravity", "Bounce", "Velocity", "Reset", "English"],
                fr: ["Physique TDAH", "Gravité", "Rebond", "Vitesse", "Réinitialiser", "Français"],
                de: ["ADHS Physik", "Gravitation", "Abprall", "Tempo", "Reset", "Deutsch"],
                it: ["Fisica TDAH", "Gravità", "Rimbalzo", "Velocità", "Ripristina", "Italiano"],
                pt: ["Física TDAH", "Gravidade", "Salto", "Velocidade", "Reiniciar", "Português"],
                ru: ["Физика СДВГ", "Гравитация", "Прыжок", "Скорость", "Сброс", "Русский"],
                ja: ["TDAH 物理学", "重力", "反発係数", "速度", "リセット", "日本語"],
                zh: ["多动症物理", "重力", "反弹", "速度", "重置", "中文"],
                ko: ["TDAH 물리학", "중력", "반발", "속도", "초기화", "한국어"],
                ar: ["الفيزياء", "الجاذبية", "الارتداد", "السرعة", "إعادة ضبط", "العربية"],
                hi: ["भौतिकी", "गुरुत्वाकर्षण", "उछाल", "गति", "रीसेट", "हिन्दी"],
                tr: ["Fizik", "Yerçekimi", "Sıçrama", "Hız", "Sıfırla", "Türkçe"],
                vi: ["Vật lý", "Trọng lực", "Độ nảy", "Tốc độ", "Đặt lại", "Tiếng Việt"],
                th: ["ฟิสิกส์", "แรงโน้มถ่วง", "การกระดอน", "ความเร็ว", "รีเซ็ต", "ไทย"],
                nl: ["Fysica", "Zwaartekracht", "Stuiteren", "Snelheid", "Reset", "Nederlands"],
                pl: ["Fizyka", "Grawitacja", "Odbicie", "Prędkość", "Reset", "Polski"],
                sv: ["Fysik", "Gravitation", "Studs", "Hastighet", "Återställ", "Svenska"],
                no: ["Fysikk", "Gravitasjon", "Sprette", "Hastighet", "Nullstill", "Norsk"],
                da: ["Fysik", "Tyngdekraft", "彈力", "Hastighed", "Nulstil", "Dansk"],
                fi: ["Fysiikka", "Painovoima", "Kimmoisuus", "Nopeus", "Nollaa", "Suomi"],
                el: ["Φυσική", "Βαρύτητα", "Αναπήδηση", "Ταχύτητα", "Επαναφορά", "Ελληνικά"],
                hu: ["Fizika", "Gravitáció", "Visszapattanás", "Sebesség", "Visszaállítás", "Magyar"],
                cs: ["Fyzika", "Gravitace", "Odraz", "Rychlost", "Resetovat", "Čeština"],
                he: ["פיזיקה", "כבידה", "החזרה", "מהירות", "איפוס", "עברית"],
                id: ["Fisika", "Gravitasi", "Pantulan", "Kecepatan", "Reset", "Bahasa Indonesia"],
                ms: ["Fizik", "Graviti", "Lantunan", "Kelajuan", "Reset", "Bahasa Melayu"],
                ro: ["Fizică", "Gravitație", "Recul", "Viteză", "Resetare", "Română"],
                uk: ["Фізика", "Гравитація", "Відскік", "Швидкість", "Скидання", "Українська"],
                bg: ["Физика", "Гравитация", "Отскок", "Скорост", "Нулиране", "Български"],
                sk: ["Fyzika", "Gravitácia", "Odraz", "Rýchlosť", "Resetovať", "Slovenčina"],
                hr: ["Fizika", "Gravitacija", "Odbijanje", "Brzina", "Ponovno", "Hrvatski"],
                lt: ["Fizika", "Gravitacija", "Atšokimas", "Greitis", "Atstatyti", "Lietuvių"],
                sl: ["Fizika", "Gravitacija", "Odboj", "Hitrost", "Ponastavi", "Slovenščina"],
                et: ["Füüsika", "Gravitatsioon", "Põrge", "Kiirus", "Lähtesta", "Eesti"],
                lv: ["Fizika", "Gravitācija", "Atleciens", "Ātrums", "Atiestatīt", "Latviešu"],
                ca: ["Física", "Gravetat", "Rebot", "Velocitat", "Reiniciar", "Català"],
                gl: ["Física", "Gravidade", "Rebote", "Velocidade", "Reiniciar", "Galego"],
                eu: ["Fisika", "Grabitatea", "Errebotea", "Abiadura", "Berrezarri", "Euskara"],
                sw: ["Fizikia", "Uvutano", "Mdundo", "Kasi", "Weka upya", "Kiswahili"]
            };

            // 2. CONFIGURACIÓN DEL FONDO
            const bg = document.getElementById('bgCanvas');
            const ctx = bg.getContext('2d');
            const draw = () => {
                bg.width = window.innerWidth; bg.height = window.innerHeight;
                for(let x=0; x<bg.width; x+=60) for(let y=0; y<bg.height; y+=60) {
                    ctx.fillStyle = (Math.floor(x/60)%2 === Math.floor(y/60)%2) ? '#111111' : '#141414';
                    ctx.fillRect(x,y,60,60);
                }
            };
            draw(); window.onresize = draw;

            // 3. MOTOR FÍSICO
            const engine = Engine.create();
            const render = Render.create({
                element: document.getElementById('game-container'),
                engine: engine,
                options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' }
            });

            const ball = Bodies.circle(window.innerWidth/2, 200, 55, {
                restitution: 0.8, friction: 0.005,
                render: { sprite: { texture: (() => {
                    const c = document.createElement('canvas'); c.width=c.height=110;
                    const x = c.getContext('2d'); x.beginPath(); x.arc(55,55,55,0,7); x.clip();
                    x.fillStyle="#f1c40f"; x.fillRect(0,0,55,55); x.fillRect(55,55,55,55);
                    x.fillStyle="#000"; x.fillRect(55,0,55,55); x.fillRect(0,55,55,55);
                    return c.toDataURL();
                })() } }
            });

            // MUROS ULTRA-GRUESOS
            const b = 5000;
            const walls = [
                Bodies.rectangle(window.innerWidth/2, window.innerHeight+b/2, window.innerWidth+b, b, { isStatic: true, render: { visible: false } }),
                Bodies.rectangle(window.innerWidth/2, -b/2, window.innerWidth+b, b, { isStatic: true, render: { visible: false } }),
                Bodies.rectangle(-b/2, window.innerHeight/2, b, window.innerHeight+b, { isStatic: true, render: { visible: false } }),
                Bodies.rectangle(window.innerWidth+b/2, window.innerHeight/2, b, window.innerHeight+b, { isStatic: true, render: { visible: false } })
            ];

            Composite.add(engine.world, [ball, ...walls]);
            const mouse = Mouse.create(render.canvas);
            Composite.add(engine.world, MouseConstraint.create(engine, { mouse: mouse, constraint: { stiffness: 0.2, render: { visible: false } } }));

            // 4. LÓGICA DE IDIOMAS
            const sel = document.getElementById('langSelect');
            Object.keys(i18n).sort().forEach(key => {
                const opt = document.createElement('option');
                opt.value = key;
                opt.innerText = i18n[key][5]; // Muestra el nombre nativo (ej: 日本語)
                sel.appendChild(opt);
            });

            const updateUI = (code) => {
                const d = i18n[code] || i18n.en;
                document.getElementById('ui-title').innerText = d[0];
                document.getElementById('lbl-grav').innerText = d[1];
                document.getElementById('lbl-bounce').innerText = d[2];
                document.getElementById('lbl-speed').innerText = d[3];
                document.getElementById('resetBtn').innerText = d[4];
                document.getElementById('lbl-lang').innerText = d[5];
            };

            sel.onchange = (e) => updateUI(e.target.value);
            document.getElementById('gravRange').oninput = (e) => engine.gravity.y = parseFloat(e.target.value);
            document.getElementById('bounceRange').oninput = (e) => ball.restitution = parseFloat(e.target.value);
            document.getElementById('resetBtn').onclick = () => Body.setPosition(ball, { x: window.innerWidth/2, y: 150 });

            // 5. ANIMACIÓN Y SEGURIDAD
            const glow = document.getElementById('glow');
            Events.on(engine, 'afterUpdate', () => {
                document.getElementById('speedVal').innerText = (ball.speed * 10).toFixed(1);
                if(glow) {
                    glow.style.left = ball.position.x + 'px';
                    glow.style.top = ball.position.y + 'px';
                    glow.style.transform = `translate(-50%, -50%) scale(${1 + ball.speed/50})`;
                }
                // Anti-escape de emergencia
                if(ball.speed > 40) Body.setVelocity(ball, { x: ball.velocity.x * 0.9, y: ball.velocity.y * 0.9 });
            });

            updateUI('es');
            Render.run(render);
            Runner.run(Runner.create(), engine);
        };
    </script>
</body>
</html>
